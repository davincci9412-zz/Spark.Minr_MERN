const express = require('express');
const router = express.Router();
const bcrypt = require('bcryptjs');
const jwt = require('jsonwebtoken');
const keys = require('../config/keys');
const dotenv = require('dotenv');
const env = dotenv.config().parsed;

var mongoose = require('mongoose');

mongoose
  .connect(env.REACT_APP_MONGO_URL, {
    dbName: 'mockUsers',
    useNewUrlParser: true,
    useUnifiedTopology: true,
  })
  .then(() => console.log('MongoDB successfully connected'))
  .catch((err) => console.log(err));

const User = require('../models/User');

const validateLoginInput = require('../validation/login');

router.post('/register', (req, res) => {
  const { errors, isValid } = validateLoginInput(req.body);
  // Check validation
  if (!isValid) {
    return res.status(400).json(errors);
  }
  User.findOne({ email: req.body.email }).then((user) => {
    if (user) {
      return res.status(400).json({ email: 'Email already exists.' });
    } else {
      const newUser = new User({
        email: req.body.email,
        password: req.body.password,
      });
      bcrypt.genSalt(10, (err, salt) => {
        bcrypt.hash(newUser.password, salt, (err, hash) => {
          if (err) throw err;
          newUser.password = hash;
          newUser
            .save()
            .then((user) => {
              res.json({ success: 'User registered sucessfully.' });
            })
            .catch((err) => {
              res.status(400).json({ failed: 'Error ocurred.' });
            });
        });
      });
    }
  });
});

router.post('/login', (req, res) => {
  const { errors, isValid } = validateLoginInput(req.body);
  // Check validation
  if (!isValid) {
    return res.status(400).json(errors);
  }

  var email = req.body.email;
  var password = req.body.password;

  // Find user by email
  User.findOne({ email }).then((user) => {
    // Check if user exists
    if (!user) {
      return res.status(404).json({ email: 'Email not found.' });
    }

    // Check password
    bcrypt.compare(password, user.password).then((isMatch) => {
      if (isMatch) {
        // User matched
        // Create JWT Payload
        const payload = {
          id: user.id,
          name: user.name,
        };

        // Sign token
        jwt.sign(
          payload,
          keys.secretOrKey,
          {
            expiresIn: 31556926, // 1 year in seconds
          },
          (err, token) => {
            res.json({
              success: true,
              token: 'Bearer ' + token,
            });
          }
        );
      } else {
        return res.status(400).json({ password: 'Password incorrect.' });
      }
    });
  });
});

const request = require('postman-request');

router.get('/exchange2', (req, res) => {
	var url  = 'https://api-cloud.bitmart.com/spot/v1/ticker?symbol='+req.query.symbol+'_USDT'
	request(url, function (error, response, body) {
		body = {"message":"OK","code":1000,"trace":"9025af0f-1973-4e31-be76-54efc6f3dd62","data":{"tickers":[{"symbol":"SAFEMOON_USDT","last_price":"0.00000399","quote_volume_24h":"6766148.27010904","base_volume_24h":"1781521659454.000000000000000000000000000000","high_24h":"0.00000411","low_24h":"0.000003260000000000000000000000","open_24h":"0.00000396","close_24h":"0.00000399","best_ask":"0.00000399","best_ask_size":"65792612","best_bid":"0.00000398","best_bid_size":"180502885","fluctuation":"+0.0076","url":"https://www.bitmart.com/trade?symbol=SAFEMOON_USDT"}]}}
		body = JSON.stringify(body)
		return res.status(200).json(body);
	});
});

router.get('/exchange3', (req, res) => {
	var url  = 'https://whitebit.com/api/v1/public/ticker?market='+req.query.symbol+'_USDT'
	request(url, function (error, response, body) {
		body = {"success":true,"message":null,"result":{"open":"0.0000035","bid":"0.0000036","ask":"0.00000367","low":"0.00000321","high":"0.00000371","last":"0.00000358","volume":"60153097214","deal":"209894.33128922","change":"2.29"}}
		body = JSON.stringify(body)
		return res.status(200).json(body);
	});
});

router.get('/transaction', (req, res) => {
	var url  = "https://api.coingecko.com/api/v3/coins/binance-smart-chain/contract/"+req.query.token+"/market_chart/?vs_currency=usd&days=1"
	request(url, function (error, response, body) {
		body = {"prices":[[1623126288851,3.6077922619047966e-06],[1623126607527,3.5991166711017884e-06],[1623126852825,3.604621780434326e-06],[1623127182746,3.618914800393435e-06],[1623127494127,3.6108205364665536e-06],[1623127658241,3.611728745008152e-06],[1623128070889,3.6147524976744488e-06],[1623128339444,3.613660937270461e-06],[1623128684789,3.5550262576433975e-06],[1623129012776,3.588105678616451e-06],[1623129193354,3.5877873188222904e-06],[1623129527179,3.556108339882201e-06],[1623129901998,3.5504600017120326e-06],[1623130089877,3.5452142555747132e-06],[1623130489091,3.5300902060107553e-06],[1623130780742,3.5047835866058423e-06],[1623131025580,3.508902048680223e-06],[1623131346952,3.576037191611011e-06],[1623131692374,3.5949566934209197e-06],[1623132063176,3.6122436961433815e-06],[1623132292232,3.597308013597593e-06],[1623132565102,3.5979459527292464e-06],[1623132849732,3.6202835259061187e-06],[1623133246879,3.6163054645451567e-06],[1623133489714,3.613203912017012e-06],[1623133711511,3.6137332232756005e-06],[1623134104306,3.5993891998083317e-06],[1623134334078,3.589406518284216e-06],[1623134648262,3.5913684542957553e-06],[1623135002101,3.604138353787996e-06],[1623135259047,3.599423045335054e-06],[1623135610535,3.593793154364128e-06],[1623135806330,3.602333371299268e-06],[1623136136097,3.6030332987490943e-06],[1623136485806,3.5930365329248313e-06],[1623136726799,3.572377906158914e-06],[1623136975715,3.573751262986096e-06],[1623137212312,3.596774671957526e-06],[1623138099444,3.6103711874473375e-06],[1623138494152,3.600132930206711e-06],[1623138823147,3.604943247381461e-06],[1623139168129,3.6031685747059556e-06],[1623139485579,3.5527888830754915e-06],[1623139558987,3.5551259030716413e-06],[1623140099668,3.5819658296551853e-06],[1623140462511,3.592278658442649e-06],[1623140961019,3.5683700761615168e-06],[1623141226098,3.574261331978936e-06],[1623141535057,3.6155364214750134e-06],[1623141885775,3.621459313267957e-06],[1623142261186,3.654164390139899e-06],[1623142445906,3.6330815225927398e-06],[1623142795954,3.6289137680544253e-06],[1623143093005,3.6322038469196176e-06],[1623143390125,3.621336668027922e-06],[1623143687831,3.566536042806425e-06],[1623144017116,3.5759358764128863e-06],[1623144256875,3.5790116930739463e-06],[1623144580255,3.58130146875934e-06],[1623144846557,3.519066696480367e-06],[1623145216478,3.5536692408441964e-06],[1623145485808,3.5541851689492755e-06],[1623145861425,3.5441544442028595e-06],[1623146046441,3.5464406768042834e-06],[1623146337812,3.54452075830298e-06],[1623146619446,3.5446756824314153e-06],[1623147044037,3.5676716182686385e-06],[1623147304229,3.570885672535029e-06],[1623147468504,3.5796984099053006e-06],[1623147871938,3.617964671771379e-06],[1623148059802,3.6153850100101637e-06],[1623148346547,3.5799418124231017e-06],[1623148807356,3.5793285573903127e-06],[1623149109651,3.574641664710796e-06],[1623149357120,3.5799368722888786e-06],[1623149645718,3.5763713142016867e-06],[1623149925300,3.5562655565929346e-06],[1623150259328,3.5560253002618825e-06],[1623150561114,3.574588825521136e-06],[1623150832413,3.586237301903703e-06],[1623151183264,3.5807713762357826e-06],[1623151503964,3.5982395119295056e-06],[1623151743850,3.6019920065096318e-06],[1623152069241,3.6002327631621494e-06],[1623152374390,3.5996447526687977e-06],[1623152631191,3.6003798356961104e-06],[1623152978691,3.6201456365598564e-06],[1623153272915,3.6263544063582637e-06],[1623153657778,3.6100797924833533e-06],[1623153827370,3.605389914944881e-06],[1623154190271,3.6057547530399257e-06],[1623154479815,3.6118299492934804e-06],[1623154779605,3.6185728318889994e-06],[1623155071587,3.624500611968068e-06],[1623155413456,3.623035280308804e-06],[1623155654707,3.6222137929242136e-06],[1623156055315,3.5672670131234714e-06],[1623156264939,3.562359787186873e-06],[1623156541600,3.5521936868577994e-06],[1623156896489,3.557278270419124e-06],[1623157132953,3.5659733946177755e-06],[1623157438180,3.5660516798315574e-06],[1623157855268,3.5539748344567428e-06],[1623158416357,3.549840226371256e-06],[1623158672419,3.5738597632799355e-06],[1623158936660,3.566252166167266e-06],[1623159235362,3.549750358409363e-06],[1623159545808,3.535844837825623e-06],[1623159882493,3.540865684710414e-06],[1623160048270,3.542287314519131e-06],[1623160450698,3.5399755932805766e-06],[1623160765069,3.514698672671385e-06],[1623160854286,3.514710206239361e-06],[1623161399835,3.5537395136333384e-06],[1623161591454,3.552289369511918e-06],[1623161985494,3.532992907660335e-06],[1623162223284,3.5179071574178204e-06],[1623162409890,3.5258206587470762e-06],[1623162904331,3.553407404200519e-06],[1623163167081,3.5612907790349153e-06],[1623163398547,3.5142019381782545e-06],[1623163843086,3.512162966855743e-06],[1623163971592,3.510698286605826e-06],[1623164356736,3.48233952539234e-06],[1623164648595,3.47448765473402e-06],[1623164981366,3.438828818953326e-06],[1623165289402,3.425174646212134e-06],[1623165544358,3.4127064240701457e-06],[1623165888904,3.399069293031092e-06],[1623166238770,3.337500611219485e-06],[1623166508689,3.3457775759267653e-06],[1623166769432,3.2546121664749174e-06],[1623167050831,3.311410995855798e-06],[1623167404351,3.3310963941223255e-06],[1623167650768,3.318547574500556e-06],[1623167977358,3.3201076604253774e-06],[1623168196792,3.3275572246536477e-06],[1623168453978,3.3815826720827163e-06],[1623168861027,3.412952437313917e-06],[1623169171156,3.3884516397241008e-06],[1623169427464,3.467487329380757e-06],[1623169841552,3.4430757383440525e-06],[1623170029322,3.441713850577637e-06],[1623170391740,3.466024667912368e-06],[1623170657707,3.4686815596910214e-06],[1623170897811,3.471976803415923e-06],[1623171205675,3.498070458078437e-06],[1623171528580,3.5087533197470813e-06],[1623171834170,3.5062396681021444e-06],[1623172205057,3.4409965051057683e-06],[1623172446951,3.4427587073722262e-06],[1623172733543,3.4166718388900753e-06],[1623173035972,3.4039454298501798e-06],[1623173373466,3.404619216974062e-06],[1623173703747,3.417029314727871e-06],[1623173956710,3.4485290635874264e-06],[1623174154116,3.447252545142428e-06],[1623174563028,3.4399989537778545e-06],[1623174877420,3.4805128860305126e-06],[1623175167808,3.4853220190695794e-06],[1623175496299,3.5010978900507415e-06],[1623175573056,3.502672978628026e-06],[1623176081381,3.5253858200509808e-06],[1623176282284,3.525462591778485e-06],[1623176706691,3.523441450482057e-06],[1623176953203,3.533563361342879e-06],[1623177282511,3.5306824794386127e-06],[1623177544654,3.52905659420253e-06],[1623177772583,3.4262311611726738e-06],[1623178153112,3.4356513129938915e-06],[1623178463437,3.5507573988567723e-06],[1623178772467,3.572615075757768e-06],[1623179059729,3.5865129270034668e-06],[1623179314305,3.5993819309714914e-06],[1623179615049,3.6023436838595436e-06],[1623179958400,3.6041250668426843e-06],[1623180253066,3.603050786756975e-06],[1623180593627,3.563185708230982e-06],[1623180714678,3.5625082675194343e-06],[1623181218282,3.700781768461045e-06],[1623181509583,3.738581146580916e-06],[1623181839798,3.742537834591555e-06],[1623182004872,3.7380564554567265e-06],[1623182302261,3.6881295974660265e-06],[1623182618346,3.6889828453995506e-06],[1623182902985,3.6859447655343056e-06],[1623183258858,3.72967309506416e-06],[1623183568597,3.7245962674120676e-06],[1623183881259,3.589278783247423e-06],[1623184210226,3.619947719443456e-06],[1623184436877,3.636863561165823e-06],[1623184802373,3.6406993128475447e-06],[1623185109652,3.689714963590566e-06],[1623185323974,3.706255112600036e-06],[1623185639485,3.7301216814353748e-06],[1623186027472,3.683858240602633e-06],[1623186325380,3.6770743950280168e-06],[1623186569085,3.7220071362976086e-06],[1623186822880,3.7249483081327436e-06],[1623187126386,3.725616329594165e-06],[1623187491147,3.706826175199509e-06],[1623187743281,3.7060662057308858e-06],[1623188091996,3.7075498010348387e-06],[1623188380776,3.6974645518720408e-06],[1623188558285,3.6816020088414935e-06],[1623188984601,3.6991200486593103e-06],[1623189142754,3.6113591231197335e-06],[1623189606039,3.6440338951571775e-06],[1623189930619,3.6574963140535512e-06],[1623190193012,3.6590017622020375e-06],[1623190447663,3.6741229510127e-06],[1623190648830,3.67390617111776e-06],[1623191097248,3.676250443658975e-06],[1623191280257,3.678663590255706e-06],[1623191698331,3.680068021930029e-06],[1623191996732,3.7621700618691823e-06],[1623192090384,3.760577702568005e-06],[1623192560258,3.7249238214536493e-06],[1623192833857,3.715433927691237e-06],[1623193171862,3.709678331960957e-06],[1623193377953,3.7095796150486492e-06],[1623193755477,3.71727833717038e-06],[1623193896807,3.7206056397713872e-06],[1623194294111,3.7197229685941255e-06],[1623194702424,3.716913227226752e-06],[1623194915050,3.7180083211737606e-06],[1623195226589,3.712037584302107e-06],[1623195575128,3.708789926517909e-06],[1623195800473,3.7113821809813083e-06],[1623196042348,3.747961538752064e-06],[1623196509232,3.746525804633507e-06],[1623196754682,3.7353887862405595e-06],[1623197102255,3.7436858616574163e-06],[1623197377068,3.730178660019214e-06],[1623197605185,3.7278344162365624e-06],[1623198003138,3.723124353439609e-06],[1623198271188,3.696471973207013e-06],[1623198576990,3.6683678156441556e-06],[1623198888210,3.6544608072766737e-06],[1623199174122,3.6548281237427227e-06],[1623199494472,3.7066051057730984e-06],[1623199708991,3.7123016773808633e-06],[1623200070842,3.7016392386834024e-06],[1623200353445,3.697054498887474e-06],[1623200660900,3.6959254541205407e-06],[1623200829016,3.657583690818255e-06],[1623201284104,3.658315321062279e-06],[1623201550186,3.6880082087171834e-06],[1623201748882,3.688207171292615e-06],[1623202153385,3.685544920787512e-06],[1623202395107,3.6814768198782255e-06],[1623202803809,3.6801534151811905e-06],[1623203078955,3.6847546475911098e-06],[1623203336048,3.682584596558558e-06],[1623203610231,3.6772118298039462e-06],[1623203929321,3.655854744328938e-06],[1623204279463,3.651861283382815e-06],[1623204521703,3.661192091018301e-06],[1623204887357,3.657622894663479e-06],[1623205228414,3.5702581912389882e-06],[1623205453518,3.5685048673189314e-06],[1623205794879,3.5776289111882304e-06],[1623205964365,3.577812325321004e-06],[1623206315707,3.5792935317356453e-06],[1623206607628,3.5708174211482695e-06],[1623206998607,3.5738898113253773e-06],[1623207207261,3.5839370754099076e-06],[1623207326483,3.5870628469373347e-06],[1623207860530,3.591918843607779e-06],[1623208047940,3.5832505939321846e-06],[1623208442674,3.5872701396224952e-06],[1623208711729,3.585960120231335e-06],[1623209107845,3.5940086401714046e-06],[1623209390984,3.588515859985276e-06],[1623209622018,3.5883550805000306e-06],[1623210047922,3.5843148465171598e-06],[1623210298563,3.584086033986809e-06],[1623210610655,3.5927542580490974e-06],[1623210880362,3.6105224467476784e-06],[1623211222307,3.680445552609747e-06],[1623211499605,3.67485548645578e-06],[1623211795979,3.667349609080135e-06],[1623212032879,3.6697179142872545e-06],[1623212261900,3.6447692887899732e-06],[1623212675000,3.629635222879142e-06]],"market_caps":[[1623126288851,2123195640.745417],[1623126607527,2123195640.745417],[1623126852825,2093742782.9943397],[1623127182746,2093742782.9943397],[1623127494127,2105260106.3014736],[1623127658241,2105260106.3014736],[1623128070889,2100238943.3378932],[1623128339444,2100238943.3378932],[1623128684789,2070268693.4083698],[1623129012776,2070268693.4083698],[1623129193354,2070268693.4083698],[1623129527179,2083050354.4793115],[1623129901998,2068723204.2119508],[1623130089877,2068723204.2119508],[1623130489091,2058067123.9890044],[1623130780742,2058067123.9890044],[1623131025580,2038865647.044057],[1623131346952,2038865647.044057],[1623131692374,2089137055.3585489],[1623132063176,2089137055.3585489],[1623132292232,2092694216.2112398],[1623132565102,2092694216.2112398],[1623132849732,2093040705.2338471],[1623133246879,2093040705.2338471],[1623133489714,2103721022.8550093],[1623133711511,2103721022.8550093],[1623134104306,2102221008.0491393],[1623134334078,2102221008.0491393],[1623134648262,2088069407.1616924],[1623135002101,2088069407.1616924],[1623135259047,2096639374.0545719],[1623135610535,2096639374.0545719],[1623135806330,2090621249.799788],[1623136136097,2090621249.799788],[1623136485806,2095996529.1697123],[1623136726799,2095996529.1697123],[1623136975715,2078163333.8751643],[1623137212312,2078163333.8751643],[1623138099444,2100265207.2439039],[1623138494152,2100265207.2439039],[1623138823147,2094309294.5831602],[1623139168129,2094309294.5831602],[1623139485579,2102024552.1752539],[1623139558987,2102024552.1752539],[1623140099668,2079363694.9713876],[1623140462511,2079363694.9713876],[1623140961019,2089729871.3688502],[1623141226098,2075821574.3447487],[1623141535057,2075821574.3447487],[1623141885775,2103259568.4695256],[1623142261186,2103259568.4695256],[1623142445906,2125730547.9408975],[1623142795954,2125730547.9408975],[1623143093005,2108995919.6757822],[1623143390125,2108995919.6757822],[1623143687831,2106633735.5749729],[1623144017116,2106633735.5749729],[1623144256875,2080222813.8613262],[1623144580255,2080222813.8613262],[1623144846557,2083344130.3487375],[1623145216478,2083344130.3487375],[1623145485808,2067220908.292112],[1623145861425,2067220908.292112],[1623146046441,2061734657.8581479],[1623146337812,2061734657.8581479],[1623146619446,2062355724.3627982],[1623147044037,2062355724.3627982],[1623147304229,2062355724.3627982],[1623147468504,2082411585.7742863],[1623147871938,2082411585.7742863],[1623148059802,2082411585.7742863],[1623148346547,2103171488.1475217],[1623148807356,2103171488.1475217],[1623149109651,2082196432.12891],[1623149357120,2082196432.12891],[1623149645718,2081736797.4387515],[1623149925300,2081736797.4387515],[1623150259328,2069187779.810123],[1623150561114,2069187779.810123],[1623150832413,2084702213.249766],[1623151183264,2084702213.249766],[1623151503964,2083035760.56833],[1623151743850,2083035760.56833],[1623152069241,2095380400.0545557],[1623152374390,2095380400.0545557],[1623152631191,2093400886.5026398],[1623152978691,2093400886.5026398],[1623153272915,2108959851.1540449],[1623153657778,2108959851.1540449],[1623153827370,2097357059.2818756],[1623154190271,2097357059.2818756],[1623154479815,2102153654.1477165],[1623154779605,2102153654.1477165],[1623155071587,2108450744.268761],[1623155413456,2108450744.268761],[1623155654707,2107621866.2743804],[1623156055315,2107621866.2743804],[1623156264939,2075179891.446572],[1623156541600,2075179891.446572],[1623156896489,2065331431.6755002],[1623157132953,2065331431.6755002],[1623157438180,2074427357.0553012],[1623157855268,2074427357.0553012],[1623158416357,2067447456.0047526],[1623158672419,2065011492.136336],[1623158936660,2065011492.136336],[1623159235362,2064591887.9233243],[1623159545808,2064591887.9233243],[1623159882493,2056870100.879077],[1623160048270,2056870100.879077],[1623160450698,2060617815.5821452],[1623160765069,2060617815.5821452],[1623160854286,2044575672.3063545],[1623161399835,2044575672.3063545],[1623161591454,2066828970.0432832],[1623161985494,2066828970.0432832],[1623162223284,2055203568.006439],[1623162409890,2055203568.006439],[1623162904331,2066224498.1561477],[1623163167081,2066224498.1561477],[1623163398547,2071664933.1254928],[1623163843086,2071664933.1254928],[1623163971592,2043086428.2946274],[1623164356736,2043086428.2946274],[1623164648595,2023012757.8230805],[1623164981366,2023012757.8230805],[1623165289402,2023012757.8230805],[1623165544358,1988533033.9216561],[1623165888904,1985217377.1591275],[1623166238770,1985217377.1591275],[1623166508689,1944114622.9488583],[1623166769432,1944114622.9488583],[1623167050831,1929950276.7695372],[1623167404351,1929950276.7695372],[1623167650768,1937743721.51146],[1623167977358,1937743721.51146],[1623168196792,1935684938.8747892],[1623168453978,1935684938.8747892],[1623168861027,1967112270.6512709],[1623169171156,1967112270.6512709],[1623169427464,1971108041.8165379],[1623169841552,1971108041.8165379],[1623170029322,2002883617.0688179],[1623170391740,2002883617.0688179],[1623170657707,2016233319.066298],[1623170897811,2016233319.066298],[1623171205675,2020286449.8568938],[1623171528580,2020286449.8568938],[1623171834170,2040994884.02781],[1623172205057,2040994884.02781],[1623172446951,2001674099.037412],[1623172733543,2001674099.037412],[1623173035972,1980625690.7562406],[1623173373466,1980625690.7562406],[1623173703747,1980512939.6644182],[1623173956710,1980512939.6644182],[1623174154116,2005783626.9947126],[1623174563028,2005783626.9947126],[1623174877420,1997221609.5367317],[1623175167808,1997221609.5367317],[1623175496299,2030790293.9335942],[1623175573056,2030790293.9335942],[1623176081381,2049698237.488524],[1623176282284,2049698237.488524],[1623176706691,2050809161.420926],[1623176953203,2050809161.420926],[1623177282511,2055521488.38646],[1623177544654,2055521488.38646],[1623177772583,2016626313.3794699],[1623178153112,2016626313.3794699],[1623178463437,1998426256.8053706],[1623178772467,1998426256.8053706],[1623179059729,2086716881.3022745],[1623179314305,2086716881.3022745],[1623179615049,2096648642.6936326],[1623179958400,2096648642.6936326],[1623180253066,2096454034.052786],[1623180593627,2096454034.052786],[1623180714678,2072359130.8852854],[1623181218282,2072359130.8852854],[1623181509583,2153651315.450806],[1623181839798,2153651315.450806],[1623182004872,2177084759.328813],[1623182302261,2177084759.328813],[1623182618346,2146074872.1921403],[1623182902985,2146074872.1921403],[1623183258858,2146074872.1921403],[1623183568597,2169133024.228158],[1623183881259,2088464368.1189],[1623184210226,2088464368.1189],[1623184436877,2110447424.5261009],[1623184802373,2110447424.5261009],[1623185109652,2117843917.0446742],[1623185323974,2117843917.0446742],[1623185639485,2156455875.654236],[1623186027472,2156455875.654236],[1623186325380,2142950047.6964784],[1623186569085,2142950047.6964784],[1623186822880,2166408509.1816287],[1623187126386,2166408509.1816287],[1623187491147,2168058064.5531006],[1623187743281,2168058064.5531006],[1623188091996,2157993235.013243],[1623188380776,2157993235.013243],[1623188558285,2147224089.3914154],[1623188984601,2147224089.3914154],[1623189142754,2151828047.382384],[1623189606039,2151828047.382384],[1623189930619,2118920020.3537953],[1623190193012,2118920020.3537953],[1623190447663,2128490698.8032353],[1623190648830,2128490698.8032353],[1623191097248,2137160794.5861852],[1623191280257,2137160794.5861852],[1623191698331,2139928249.4942508],[1623191996732,2139928249.4942508],[1623192090384,2187578793.9565535],[1623192560258,2187578793.9565535],[1623192833857,2161347964.8303866],[1623193171862,2161347964.8303866],[1623193377953,2157912518.2900515],[1623193755477,2157912518.2900515],[1623193896807,2162390968.833052],[1623194294111,2162390968.833052],[1623194702424,2168938671.5432453],[1623194915050,2168938671.5432453],[1623195226589,2161969962.0031924],[1623195575128,2161969962.0031924],[1623195800473,2158200976.785793],[1623196042348,2158200976.785793],[1623196509232,2179608488.612817],[1623196754682,2179608488.612817],[1623197102255,2171907644.0396667],[1623197377068,2171907644.0396667],[1623197605185,2171907644.0396667],[1623198003138,2171907644.0396667],[1623198271188,2165701215.7750816],[1623198576990,2165701215.7750816],[1623198888210,2123888759.9575038],[1623199174122,2123888759.9575038],[1623199494472,2126160308.043162],[1623199708991,2126160308.043162],[1623200070842,2155904949.5107307],[1623200353445,2155904949.5107307],[1623200660900,2149343482.6067004],[1623200829016,2149343482.6067004],[1623201284104,2127615655.2339818],[1623201550186,2127615655.2339818],[1623201748882,2145390268.1277587],[1623202153385,2145390268.1277587],[1623202395107,2143841665.769024],[1623202803809,2143841665.769024],[1623203078955,2143967429.7661302],[1623203336048,2143967429.7661302],[1623203610231,2142438091.9973435],[1623203929321,2142438091.9973435],[1623204279463,2124558936.9174676],[1623204521703,2124558936.9174676],[1623204887357,2129675887.7739863],[1623205228414,2129675887.7739863],[1623205453518,2076780620.6241558],[1623205794879,2076780620.6241558],[1623205964365,2081174778.8129458],[1623206315707,2081174778.8129458],[1623206607628,2082036380.5829856],[1623206998607,2082036380.5829856],[1623207207261,2078893094.7963011],[1623207326483,2078893094.7963011],[1623207860530,2090039672.7921622],[1623208047940,2090039672.7921622],[1623208442674,2084338160.91488],[1623208711729,2084338160.91488],[1623209107845,2085914263.0922952],[1623209390984,2085914263.0922952],[1623209622018,2087400909.2977064],[1623210047922,2087400909.2977064],[1623210298563,2084957225.1465228],[1623210610655,2084957225.1465228],[1623210880362,2089866339.6643488],[1623211222307,2089866339.6643488],[1623211499605,2140875418.388093],[1623211795979,2140875418.388093],[1623212032879,2133257649.5113697],[1623212261900,2133257649.5113697],[1623212675000,2119031323.854587]],"total_volumes":[[1623126288851,22198611.561792567],[1623126607527,22162092.719598558],[1623126852825,22246088.851062886],[1623127182746,23144810.636902846],[1623127494127,23166852.207640395],[1623127658241,23149802.148450777],[1623128070889,23170176.501635816],[1623128339444,23294185.097221725],[1623128684789,22984830.30284959],[1623129012776,23097768.928059738],[1623129193354,23095616.86838033],[1623129527179,23249868.71379548],[1623129901998,23218233.34547668],[1623130089877,23258411.13193215],[1623130489091,23169686.101222105],[1623130780742,23208378.792745877],[1623131025580,23238235.550904214],[1623131346952,23720195.036830403],[1623131692374,23809884.886248123],[1623132063176,23924743.61576408],[1623132292232,23965340.68503642],[1623132565102,23971801.33550765],[1623132849732,24023992.650906324],[1623133246879,24000976.09313903],[1623133489714,24095543.979033433],[1623133711511,24102283.694062077],[1623134104306,24051016.244692784],[1623134334078,24114985.21433353],[1623134648262,24127964.091330547],[1623135002101,24252432.80152727],[1623135259047,24219376.80728384],[1623135610535,24181874.103374675],[1623135806330,24173379.41663469],[1623136136097,24181170.400451515],[1623136485806,24113933.845269807],[1623136726799,24030050.349795196],[1623136975715,24040354.7874702],[1623137212312,24189384.069789432],[1623138099444,24288851.35706171],[1623138494152,24402653.743635967],[1623138823147,24441577.658251036],[1623139168129,24428576.62586666],[1623139485579,24144754.112544842],[1623139558987,24158083.104643397],[1623140099668,24304864.620236725],[1623140462511,24471135.092756666],[1623140961019,24482864.81708596],[1623141226098,24525316.920374013],[1623141535057,24604662.822217453],[1623141885775,24639581.303479057],[1623142261186,24774933.19191961],[1623142445906,24847903.725096926],[1623142795954,24821637.973266926],[1623143093005,24855435.641302757],[1623143390125,24781232.91004298],[1623143687831,24832450.594659008],[1623144017116,24898867.892178044],[1623144256875,24925985.282518238],[1623144580255,25028266.54900168],[1623144846557,24660445.68469046],[1623145216478,24764465.39162398],[1623145485808,24768075.33555726],[1623145861425,24738545.0325151],[1623146046441,24755804.116967317],[1623146337812,24757833.31441402],[1623146619446,24758018.356900383],[1623147044037,24847899.4800718],[1623147304229,24861946.616753485],[1623147468504,24921047.866063856],[1623147871938,25149181.38537798],[1623148059802,25133137.239837755],[1623148346547,25018531.434757516],[1623148807356,25017002.47366864],[1623149109651,25051830.54373832],[1623149357120,25092849.06839431],[1623149645718,25067896.60710831],[1623149925300,25070162.449493855],[1623150259328,25066633.652810834],[1623150561114,25269689.913788605],[1623150832413,25351113.760100037],[1623151183264,25325146.576035295],[1623151503964,25426651.145369995],[1623151743850,25453852.215294354],[1623152069241,25455727.40377718],[1623152374390,25446108.077016648],[1623152631191,25449074.87381415],[1623152978691,25515125.706495903],[1623153272915,25502988.4425645],[1623153657778,25521070.14921435],[1623153827370,25663962.68834214],[1623154190271,25666981.887754325],[1623154479815,25743175.949925087],[1623154779605,25788219.949398767],[1623155071587,25793115.3524168],[1623155413456,25783690.640055712],[1623155654707,25836416.20606534],[1623156055315,25554467.18920475],[1623156264939,25520634.961464256],[1623156541600,25532571.492527854],[1623156896489,25612424.17461402],[1623157132953,25676447.312695358],[1623157438180,25677012.75324642],[1623157855268,25789434.27055743],[1623158416357,25833617.95923594],[1623158672419,25998491.718500547],[1623158936660,25943149.297803577],[1623159235362,26042826.0230229],[1623159545808,25668512.707608256],[1623159882493,25708543.648318242],[1623160048270,25721807.80863198],[1623160450698,25701817.230908137],[1623160765069,25527278.61760756],[1623160854286,25529007.909918927],[1623161399835,25789461.435905974],[1623161591454,25779932.2116216],[1623161985494,25777059.276059214],[1623162223284,25666198.17157552],[1623162409890,25791819.23200379],[1623162904331,25802383.20856536],[1623163167081,25864541.76391303],[1623163398547,25825419.971873935],[1623163843086,25779797.29014243],[1623163971592,25769046.319260705],[1623164356736,25801801.527075876],[1623164648595,25756300.50033348],[1623164981366,25851817.978778485],[1623165289402,25876006.349240523],[1623165544358,25964297.561490368],[1623165888904,25863563.816946864],[1623166238770,25971653.23316449],[1623166508689,26037124.00400729],[1623166769432,25527820.94972492],[1623167050831,25710708.30899996],[1623167404351,25864379.460478455],[1623167650768,25986957.78040056],[1623167977358,26261784.780280136],[1623168196792,26320088.341552474],[1623168453978,26598307.83007705],[1623168861027,26845919.243548512],[1623169171156,26784437.27223922],[1623169427464,27481994.92095424],[1623169841552,27542574.979684934],[1623170029322,27545380.664693326],[1623170391740,27666019.460720375],[1623170657707,27688467.07672377],[1623170897811,28034432.614728145],[1623171205675,28124026.75399796],[1623171528580,28212388.992948666],[1623171834170,28204675.851113055],[1623172205057,27783947.309864827],[1623172446951,27798078.02183587],[1623172733543,27844512.23199403],[1623173035972,27742256.50520786],[1623173373466,27879198.123720903],[1623173703747,28115721.209986027],[1623173956710,28160714.68011207],[1623174154116,28151576.986370873],[1623174563028,28087759.765348487],[1623174877420,28618700.338111203],[1623175167808,28659053.66085757],[1623175496299,28661274.707755078],[1623175573056,28674206.56140883],[1623176081381,28858227.906804096],[1623176282284,28942319.758094504],[1623176706691,28928416.477034766],[1623176953203,28994640.93488829],[1623177282511,28970713.182549853],[1623177544654,28958280.989815015],[1623177772583,28597684.224199895],[1623178153112,28676120.896302357],[1623178463437,28752616.338518415],[1623178772467,28873873.97547128],[1623179059729,29045895.891036525],[1623179314305,29106486.46446481],[1623179615049,29131420.876584966],[1623179958400,29258791.579680983],[1623180253066,29250317.952578615],[1623180593627,29283673.859875724],[1623180714678,29278687.064060476],[1623181218282,30188566.683321368],[1623181509583,30388307.45707433],[1623181839798,30414555.594027363],[1623182004872,30378263.49521138],[1623182302261,30212130.99765041],[1623182618346,30226612.76658347],[1623182902985,30237826.286900047],[1623183258858,30265852.295848478],[1623183568597,30225794.851951707],[1623183881259,29707524.7624838],[1623184210226,29961214.34497521],[1623184436877,30184795.69250355],[1623184802373,30220365.318521865],[1623185109652,30378998.54307065],[1623185323974,30516012.116009265],[1623185639485,30715512.738686863],[1623186027472,30645560.531546693],[1623186325380,30544064.7952825],[1623186569085,30612176.496367417],[1623186822880,30610253.576859035],[1623187126386,30610191.29725844],[1623187491147,30661807.912331097],[1623187743281,30612260.24106199],[1623188091996,30622334.81624278],[1623188380776,30521331.149183426],[1623188558285,30368035.613569878],[1623188984601,30481685.41320462],[1623189142754,29864258.216032516],[1623189606039,29893498.61821764],[1623189930619,30003643.246995907],[1623190193012,30007781.078092396],[1623190447663,29951672.34587735],[1623190648830,29949113.976222303],[1623191097248,29936430.005830675],[1623191280257,29959831.24585327],[1623191698331,29887972.8680629],[1623191996732,30411702.815449346],[1623192090384,30398336.977658443],[1623192560258,30177754.455008123],[1623192833857,30099289.0718398],[1623193171862,30170262.026600458],[1623193377953,30175951.89002825],[1623193755477,30196347.469782934],[1623193896807,30227483.877598293],[1623194294111,30217388.97193175],[1623194702424,30188759.73612906],[1623194915050,29221304.310809612],[1623195226589,31302656.258918997],[1623195575128,31274618.361708883],[1623195800473,31289788.061644312],[1623196042348,31269365.456669748],[1623196509232,31249762.733731676],[1623196754682,31200871.00069107],[1623197102255,31305491.449126065],[1623197377068,31194495.32654216],[1623197605185,31175273.352589436],[1623198003138,31134191.631792683],[1623198271188,31112429.39431472],[1623198576990,30873404.141807124],[1623198888210,31058073.316433914],[1623199174122,31061415.750219963],[1623199494472,31042595.322137225],[1623199708991,31090066.534004778],[1623200070842,30606638.742984194],[1623200353445,30576737.483616505],[1623200660900,30567314.112129964],[1623200829016,30512348.815586437],[1623201284104,30515565.246447675],[1623201550186,30542782.879671406],[1623201748882,30544306.88504304],[1623202153385,30523101.59306709],[1623202395107,30487622.84913675],[1623202803809,30286439.071457762],[1623203078955,30255372.659864783],[1623203336048,30235810.88099896],[1623203610231,30196699.52761617],[1623203929321,30050077.769265212],[1623204279463,30012100.370159112],[1623204521703,30117178.210717138],[1623204887357,30087759.504927665],[1623205228414,29418402.92213657],[1623205453518,29403686.882131577],[1623205794879,29237695.182127528],[1623205964365,29239620.597936954],[1623206315707,29250667.297975134],[1623206607628,29233220.056271315],[1623206998607,29256923.493958063],[1623207207261,29339227.762942053],[1623207326483,29337427.00325798],[1623207860530,29374075.470711228],[1623208047940,29152056.17441554],[1623208442674,29176954.960732143],[1623208711729,29196245.845489096],[1623209107845,29269486.235701967],[1623209390984,29171648.51844581],[1623209622018,29170398.477288898],[1623210047922,29133999.917908814],[1623210298563,28998765.17107896],[1623210610655,29100629.723025694],[1623210880362,26980665.314179946],[1623211222307,27167055.521658547],[1623211499605,27075125.35509102],[1623211795979,27020121.705957327],[1623212032879,27037570.790924516],[1623212261900,26847686.72761002],[1623212675000,26732955.706814066]]}
		body = JSON.stringify(body)
		return res.status(200).json(body);
	});
});

router.get('/trend', (req, res) => {
	var url  = "https://api.coingecko.com/api/v3/coins/"+req.query.chain+"/market_chart?vs_currency=usd&days=2"
	request(url, function (error, response, body) {
		body = {"prices":[[1623043089729,400.62689131190643],[1623046100236,400.6112136587476],[1623049784517,394.6311088611523],[1623053382872,396.4860343673437],[1623056971577,395.6675161855822],[1623060958891,402.12120853679744],[1623063741905,404.39882057703915],[1623067324965,400.25235867980837],[1623071069990,404.0655436437421],[1623075000192,398.5131964052305],[1623078288986,395.52324649367887],[1623082699044,394.6566911150084],[1623085982224,389.27440196377944],[1623089199780,386.79043805124377],[1623092925432,383.6334224087875],[1623097302869,387.8354874168949],[1623100194039,370.3711020356311],[1623104072210,364.05802611853437],[1623107494332,365.32246428708004],[1623111191267,361.4911166708215],[1623114932451,362.71456646696623],[1623118589111,361.7961058594847],[1623122163702,344.2298608582298],[1623125097387,346.27902045765677],[1623128566369,349.4872134293495],[1623133109837,347.80312339063556],[1623136134216,344.9961846062138],[1623139702099,351.72837064432264],[1623143198880,354.6295286264928],[1623146746579,349.11263705589977],[1623150770710,349.707601586502],[1623154021628,353.7860224906783],[1623158099179,349.69030093169994],[1623161657234,342.15251945224674],[1623165434871,329.3047777758749],[1623168525596,333.0245413433894],[1623172599230,338.85167288386714],[1623175729808,340.8227263366315],[1623179146430,348.7821524112523],[1623183047287,349.9909292685366],[1623187042682,355.43882755134916],[1623190718823,353.4155288264103],[1623194081162,353.1385914736079],[1623198184414,348.4275316902617],[1623200820376,345.67175137195585],[1623204571861,336.61533732773523],[1623208504677,341.429951232101],[1623211958101,341.7331210930392],[1623214699000,341.393493872863]],"market_caps":[[1623043089729,61818156981.18264],[1623046100236,61958801149.91752],[1623049784517,61082881618.16031],[1623053382872,61043799754.40909],[1623056971577,61161360792.20816],[1623060958891,61557478211.04672],[1623063741905,62412372595.85182],[1623067324965,61965531450.96608],[1623071069990,62536727325.325005],[1623075000192,61867321867.24781],[1623078288986,61016983751.67308],[1623082699044,61120195309.96071],[1623085982224,60155994926.65136],[1623089199780,59732186317.93237],[1623092925432,59295877216.714874],[1623097302869,59975390129.8077],[1623100194039,57630561399.48524],[1623104072210,56259216279.60271],[1623107494332,56427206218.66053],[1623111191267,55054377441.75441],[1623114932451,55820282057.86065],[1623118589111,55848556644.850784],[1623122163702,53121890794.4374],[1623125097387,53005186048.958046],[1623128566369,53913952410.01324],[1623133109837,53811133598.647224],[1623136134216,53367781182.22324],[1623139702099,54334422813.67221],[1623143198880,54983954908.04789],[1623146746579,53975321925.83348],[1623150770710,53886776589.19152],[1623154021628,54662880492.90491],[1623158099179,54038919236.98556],[1623161657234,52903280011.729645],[1623165434871,51666716057.15095],[1623168525596,51177275144.31257],[1623172599230,52377950257.299164],[1623175729808,52390062482.17967],[1623179146430,53871095266.26135],[1623183047287,54198107452.42093],[1623187042682,54927464878.453575],[1623190718823,54705962660.27668],[1623194081162,54571796167.23883],[1623198184414,53996610793.24985],[1623200820376,53405517182.596565],[1623204571861,51991517369.164246],[1623208504677,52762417231.93547],[1623211958101,52808426284.44934],[1623214699000,52686415686.18385]],"total_volumes":[[1623043089729,3256778177.0820312],[1623046100236,3292598104.2736287],[1623049784517,2813737216.7452583],[1623053382872,3207632511.906287],[1623056971577,3153030277.071688],[1623060958891,3421239824.758875],[1623063741905,2445133715.6459756],[1623067324965,3355446929.2912416],[1623071069990,3467950280.433504],[1623075000192,3334929316.3297653],[1623078288986,2528903117.283168],[1623082699044,2523856375.346785],[1623085982224,3134133626.3413196],[1623089199780,2657932119.7459316],[1623092925432,2734595611.4719],[1623097302869,2525252887.9225807],[1623100194039,3686776876.7482595],[1623104072210,3680240770.6229773],[1623107494332,4107731417.0171075],[1623111191267,4276534736.1093464],[1623114932451,4357850660.431855],[1623118589111,3690700538.537411],[1623122163702,3845974384.168219],[1623125097387,4661028485.735972],[1623128566369,4759097803.046713],[1623133109837,4963426390.213952],[1623136134216,4521643717.994388],[1623139702099,3346519873.031992],[1623143198880,5125477971.558881],[1623146746579,4337947550.8984165],[1623150770710,5294478263.819999],[1623154021628,5341989639.578398],[1623158099179,5328430155.02151],[1623161657234,4927366600.512707],[1623165434871,4587130810.060566],[1623168525596,5460377024.723833],[1623172599230,5107740363.10068],[1623175729808,5256961302.336473],[1623179146430,5726469125.31429],[1623183047287,5498544085.740428],[1623187042682,5703914457.179089],[1623190718823,5372731761.035909],[1623194081162,5860007798.178894],[1623198184414,5708101386.833149],[1623200820376,5683112236.496182],[1623204571861,4866513792.188637],[1623208504677,5449134439.161147],[1623211958101,5046161570.984725],[1623214699000,5016448519.180511]]}
		body = JSON.stringify(body)
		return res.status(200).json(body);
	});
});

router.get('/coinPrice', (req, res) => {
	var url  = 'https://api.coingecko.com/api/v3/coins/'+req.query.chain+'/market_chart?vs_currency=usd&days=2'
	request(url, function (error, response, body) {
		body = {"message":"OK","code":1000,"trace":"f56d62e1-2949-47be-b342-d9a74cad69ab","data":{"tickers":[{"symbol":"ETH_USDT","last_price":"2449.18","quote_volume_24h":"71434372.8116030","base_volume_24h":"28998.525900000000000000000000000000","high_24h":"2554.27","low_24h":"2320.43","open_24h":"2488.49","close_24h":"2449.18","best_ask":"2449.85","best_ask_size":"0.16369","best_bid":"2448.34","best_bid_size":"11.17769","fluctuation":"-0.0158","url":"https://www.bitmart.com/trade?symbol=ETH_USDT"}]}}
		body = JSON.stringify(body)
		return res.status(200).json(body);
	});
});
module.exports = router;
